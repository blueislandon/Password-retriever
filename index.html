<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Terminal Fetcher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            background-color: #0a0a0a;
            color: #00ff41; /* Classic Matrix/Terminal Green */
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 50px;
        }

        .terminal-container {
            width: 80%;
            max-width: 800px;
        }

        /* This is your "Text Area" that isn't editable */
        #output-window {
            background-color: #000;
            border: 1px solid #333;
            border-radius: 5px;
            height: 400px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
            white-space: pre-wrap; /* Maintains formatting/newlines */
            word-wrap: break-word;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            background: #00ff41;
            color: black;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        button:hover {
            background: #00cc33;
        }

        .status {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <div class="terminal-container">
        <div class="status">SYSTEM READY... STANDBY FOR DATA</div>
        <div id="output-window">/root/user/data_fetcher >_ </div>
        
        <div class="controls">
            <button onclick="fetchFromSupabase()">Execute Fetch</button>
            <button onclick="clearTerminal()">Clear</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // 1. Setup Supabase Client
    // Renamed 'supabase' to 'supabaseClient' to avoid naming conflicts
    const MASTER = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqYmxkdGlwcHdyZHh5bmZ3aWR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNTMyMzIsImV4cCI6MjA4NzYyOTIzMn0.7EQHHbYGSPH1mI6kh-XuyMVWxaPrQ4qw7PIBcy-j8I0";
    const _supabaseUrl = 'https://fjbldtippwrdxynfwidx.supabase.co';
    const _supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqYmxkdGlwcHdyZHh5bmZ3aWR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNTMyMzIsImV4cCI6MjA4NzYyOTIzMn0.7EQHHbYGSPH1mI6kh-XuyMVWxaPrQ4qw7PIBcy-j8I0';
    
    // Check if the library is loaded and create the client
    const supabaseClient = supabase.createClient(_supabaseUrl, _supabaseKey);
    const output = document.getElementById('output-window');

function decryptValue(cipherText) {
    if (!cipherText) return "[No Data]";
    try {
        // We explicitly tell CryptoJS to decrypt using our MASTER string
        const bytes = CryptoJS.AES.decrypt(cipherText, MASTER);
        
        // Convert to UTF8 string manually to avoid CSP 'eval' issues
        const originalText = bytes.toString(CryptoJS.enc.Utf8);
        
        // If it's empty, the key or the cipherText is wrong
        if (!originalText || originalText.length === 0) {
            return "[Key Mismatch]";
        }
        
        return originalText;
    } catch (e) {
        console.error("Decryption error:", e);
        return "[Decryption Error]";
    }
}
async function fetchFromSupabase() {
    logToTerminal("\n>_ ACCESSING ENCRYPTED TERMINAL...");
    
    try {
        // Change 'your_table_name' to the actual name of your table
        let { data, error } = await supabaseClient
            .from('passwords') 
            .select('*');

        if (error) throw error;

        logToTerminal(">_ DATA RETRIEVED. RUNNING DECRYPTION ALGORITHM...");

        // Process the data
        const decryptedData = data.map(row => {
            return {
                username: row.username,
                // We target row.password because that's what shows in your image
                password: decryptValue(row.password), 
                created_at: row.created_at
            };
        });

        logToTerminal("------------------------------------------");
        logToTerminal(JSON.stringify(decryptedData, null, 2));
        logToTerminal("------------------------------------------");
        logToTerminal(">_ SESSION COMPLETE.");
        
    } catch (err) {
        logToTerminal("!! SYSTEM ERROR: " + err.message);
    }
}

    function logToTerminal(message) {
        output.innerText += "\n" + message;
        output.scrollTop = output.scrollHeight;
    }

    function clearTerminal() {
        output.innerText = "/root/user/password_retriever >_";
    }
</script>
</body>
</html>
